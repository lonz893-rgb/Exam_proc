<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Online Proctor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="styles/style.css">
  <style>
    /* Fullscreen enforcement styling */
    #fullscreenWarning {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      color: white;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      text-align: center;
      padding: 2rem;
    }
    
    #fullscreenWarning.active {
      display: flex;
    }
    
    #fullscreenWarning h1 {
      color: #ff6b6b;
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    
    #fullscreenWarning p {
      font-size: 1.2rem;
      margin-bottom: 2rem;
      max-width: 600px;
    }
    
    .fullscreen-btn {
      padding: 1rem 3rem;
      font-size: 1.2rem;
      background: #4285f4;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .fullscreen-btn:hover {
      background: #357ae8;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div id="fullscreenWarning">
    <i class="bi bi-fullscreen" style="font-size: 5rem; margin-bottom: 1rem; color: #4285f4;"></i>
    <h1>Fullscreen Required</h1>
    <p>This exam must be taken in fullscreen mode for security purposes. Please click the button below to enter fullscreen mode.</p>
    <button class="fullscreen-btn" onclick="enterFullscreenMode()">
      <i class="bi bi-fullscreen me-2"></i>Enter Fullscreen
    </button>
    <p style="margin-top: 2rem; font-size: 0.9rem; color: #999;">Exiting fullscreen during the exam will be counted as a violation.</p>
  </div>

  <div class="carousel-bg">
    <div class="carousel-slide active" style="background-image: url('photo1.jpg');"></div>
    <div class="carousel-slide" style="background-image: url('photo2.jpg');"></div>
    <div class="carousel-slide" style="background-image: url('photo3.jpg');"></div>
  </div>
  
  <header class="header-bg">
    <h1><i class="bi bi-shield-check me-2"></i>Proctool</h1>
    <h2>Designed to secure online exams</h2>
  </header>

  <main class="container py-5">
    <div class="card card-custom mx-auto" id="startCard">
      <div class="card-body">
        <h5 class="card-title">Start Your Exam</h5>
        <p class="text-center text-secondary" style="margin-bottom: 2rem; font-size: 0.95rem;">
          Enter your details below to begin the assessment. Make sure you have a stable internet connection and use a compatible browser.
        </p>

        <form id="userForm">
          <div class="row">
            <div class="col-md-6">
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="inputLastName" placeholder="Last Name" required autocomplete="off">
                <label for="inputLastName"><i class="bi bi-person-badge me-2"></i>Last Name</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating mb-3">
                <input type="text" class="form-control" id="inputFirstName" placeholder="First Name" required autocomplete="off">
                <label for="inputFirstName"><i class="bi bi-person me-2"></i>First Name</label>
              </div>
            </div>
          </div>

          <input type="hidden" id="lastName" value="">

          <div class="form-floating mb-3">
            <input type="text" class="form-control" id="firstName" placeholder="Section" required autocomplete="off">
            <label for="firstName"><i class="bi bi-layers me-2"></i>Section/Class Number</label>
          </div>

          <div class="form-floating mb-4">
            <input type="text" class="form-control" id="code" placeholder="Test Code" required autocomplete="off">
            <label for="code"><i class="bi bi-key me-2"></i>Test Code (from your instructor)</label>
          </div>

          <div class="alert alert-info d-flex align-items-start" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.2);">
            <i class="bi bi-info-circle me-2" style="color: var(--accent); margin-top: 0.25rem;"></i>
            <div>
              <strong>System Requirements:</strong>
              <ul style="margin: 0.5rem 0 0 0; padding-left: 1.25rem; font-size: 0.9rem;">
                <li>Modern browser (Chrome, Firefox, Safari, Edge)</li>
                <li>Stable internet connection</li>
                <li><strong>Fullscreen mode will be enforced</strong></li>
              </ul>
            </div>
          </div>
        </form>

        <button class="btn btn-accent btn-lg" id="startBtn" style="width: 100%; margin-top: 1rem;">
          <i class="bi bi-play-fill me-2"></i>BEGIN EXAM
        </button>

        <div class="loading-spinner" id="startLoadingSpinner">
          <div class="loader" aria-hidden="true"></div>
          <p class="mt-3">Initializing exam environment...</p>
        </div>
      </div>
    </div>

    <div style="margin-top: 3rem; padding: 0 1rem; max-width: 700px; margin-left: auto; margin-right: auto;">
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
        <div style="text-align: center; padding: 1rem; border-radius: 8px; background: var(--secondary); border: 1px solid var(--border);">
          <i class="bi bi-shield-exclamation" style="font-size: 1.5rem; color: var(--accent); display: block; margin-bottom: 0.5rem;"></i>
          <h6 style="margin-bottom: 0.5rem;">Anti-Cheat Monitoring</h6>
          <p style="font-size: 0.85rem; color: var(--text-muted); margin: 0;">Screen, browser, and activity monitoring active</p>
        </div>
        <div style="text-align: center; padding: 1rem; border-radius: 8px; background: var(--secondary); border: 1px solid var(--border);">
          <i class="bi bi-clock-history" style="font-size: 1.5rem; color: var(--accent); display: block; margin-bottom: 0.5rem;"></i>
          <h6 style="margin-bottom: 0.5rem;">Timed Assessment</h6>
          <p style="font-size: 0.85rem; color: var(--text-muted); margin: 0;">Real-time timer with automatic submission</p>
        </div>
      </div>
    </div>
  </main>

  <div class="modal fade" id="instructionModal" tabindex="-1" aria-labelledby="instructionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="instructionModalLabel">
            <i class="bi bi-info-circle me-2"></i>Monitored Exam Instructions
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body modal-body-custom">
          
          
          <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1.5rem;">
            <h6 style="color: var(--danger); margin-bottom: 0.75rem; display: flex; align-items: center;">
              <i class="bi bi-shield-exclamation me-2"></i>Security & Conduct Policy
            </h6>
            <ul style="margin: 0; padding-left: 1.25rem; font-size: 0.9rem; color: var(--text-secondary);">
              <li><strong>Fullscreen mode is mandatory</strong> - exiting fullscreen will count as a violation</li>
              <li>No tab switching or window minimizing during the exam</li>
              <li>No screenshots, screen recording, or external devices</li>
              <li>No copying, pasting, or external resources</li>
              <li>Avoid resizing your browser window</li>
              <li>Use Skip button when needed</li>
              <li>Automatically submit when a certain violation count is reached</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="cancelStart" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-accent" id="agreeBtn">I Understand - Start Exam</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="noInternetModal" tabindex="-1" aria-labelledby="noInternetLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="noInternetLabel">
            <i class="bi bi-wifi-off me-2"></i>Connection Required
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center modal-body-custom">
          <p id="noInternetText">No stable internet connection detected. Please check your connection and try again.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-accent" id="retryOnline">Retry Connection</button>
        </div>
      </div>
    </div>
  </div>

  <footer>
    Proverbs 16:28 A fraudulent man sows strife: and a whisperer separates chief friends.
  </footer>

  <script>
    // This script automatically takes what is typed in First/Last name and 
    // feeds it into the hidden input so your login.js still functions normally!
    const inputFirst = document.getElementById('inputFirstName');
    const inputLast = document.getElementById('inputLastName');
    const hiddenFull = document.getElementById('lastName');

    function updateFullName() {
      const first = inputFirst.value.trim();
      const last = inputLast.value.trim();
      
      if (first && last) {
        hiddenFull.value = last + ', ' + first;
      } else if (last) {
        hiddenFull.value = last;
      } else if (first) {
        hiddenFull.value = first;
      } else {
        hiddenFull.value = '';
      }
    }

    inputFirst.addEventListener('input', updateFullName);
    inputLast.addEventListener('input', updateFullName);
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Auto-rotate carousel background slides every 6 seconds
    let currentSlide = 0;
    const slides = document.querySelectorAll('.carousel-slide');
    
    function rotateCarousel() {
      slides.forEach((slide, index) => {
        slide.classList.remove('active');
      });
      currentSlide = (currentSlide + 1) % slides.length;
      slides[currentSlide].classList.add('active');
    }
    
    setInterval(rotateCarousel, 6000);
  </script>

  <script>
    // Fullscreen helper functions
    function requestFullscreen() {
      const el = document.documentElement;
      if (el.requestFullscreen) return el.requestFullscreen();
      if (el.mozRequestFullScreen) return el.mozRequestFullScreen();
      if (el.webkitRequestFullscreen) return el.webkitRequestFullscreen();
      if (el.msRequestFullscreen) return el.msRequestFullscreen();
      return Promise.resolve();
    }

    function inFullscreen() {
      return !!(document.fullscreenElement || document.webkitFullscreenElement ||
                document.mozFullScreenElement || document.msFullscreenElement);
    }

    function showFullscreenWarning() {
      const warning = document.getElementById('fullscreenWarning');
      if (warning) {
        warning.classList.add('active');
      }
    }

    function hideFullscreenWarning() {
      const warning = document.getElementById('fullscreenWarning');
      if (warning) {
        warning.classList.remove('active');
      }
    }

    async function enterFullscreenMode() {
      try {
        await requestFullscreen();
        hideFullscreenWarning();
        console.log('[Fullscreen] Entered fullscreen mode');
      } catch (e) {
        console.warn('[Fullscreen] Failed to enter fullscreen:', e);
        alert('⚠️ Fullscreen mode is required. Please allow fullscreen when prompted.');
      }
    }

    // Check fullscreen status on load and periodically
    function checkFullscreenStatus() {
      if (!inFullscreen() && sessionStorage.getItem('exam_fullscreen_required') === 'true') {
        showFullscreenWarning();
      } else {
        hideFullscreenWarning();
      }
    }

    // Monitor fullscreen changes
    document.addEventListener('fullscreenchange', checkFullscreenStatus);
    document.addEventListener('webkitfullscreenchange', checkFullscreenStatus);
    document.addEventListener('mozfullscreenchange', checkFullscreenStatus);
    document.addEventListener('msfullscreenchange', checkFullscreenStatus);

    // Check every 2 seconds
    setInterval(checkFullscreenStatus, 2000);
  </script>

  <div class="modal fade" id="warningModal" tabindex="-1" aria-labelledby="warningModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="warningModalLabel">
            <i class="bi bi-exclamation-triangle-fill me-2" style="color: var(--warning);"></i>Security Warning
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center modal-body-custom">
          <div class="warn-text mb-3">Suspicious activity detected</div>
          <p id="warningText">Do not switch tabs, minimize the window, or use external devices during the exam. Multiple violations will result in disqualification.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-accent" id="continueBtn">Continue Exam</button>
          <button type="button" class="btn btn-secondary" id="exitBtn" data-bs-dismiss="modal">Exit Exam</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="confirmModalLabel">Confirm Submission</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center modal-body-custom">
          <p id="confirmText">Are you sure you want to submit this answer? You cannot change it after submission.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="confirmNo" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-accent" id="confirmYes">Submit Answer</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="duplicateModal" tabindex="-1" aria-labelledby="duplicateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="duplicateModalLabel">
            <i class="bi bi-exclamation-circle-fill me-2" style="color: var(--danger);"></i>Duplicate Entry
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center modal-body-custom">
          <p id="duplicateText">An exam session with this user is already in progress. Please contact your instructor if this is an error.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="duplicateOk" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content modal-content-custom">
        <div class="modal-header modal-header-custom">
          <h5 class="modal-title" id="errorModalLabel">
            <i class="bi bi-exclamation-diamond-fill me-2" style="color: var(--danger);"></i>Error
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body modal-body-custom">
          <div id="errorText" class="alert alert-danger" style="margin: 0; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3);">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="errorOk" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>

  
  <script src="scripts/login.js"></script>
  <script>
    // Global API endpoint for this deployment
    window.ANSWER_API_URL = 'https://script.google.com/macros/s/AKfycbzD91fLtEjVXi3A2y3pNBeToiUuOWwbMNcWUC-TYVn2VnEte0yxzbjpa12n42yboqD2/exec';
    
    // Set Next.js API URL (update this to your deployed Next.js URL)
    window.NEXTJS_API_URL = 'http://localhost:3000'; // Change to your production URL
  </script>
</body>

</html>